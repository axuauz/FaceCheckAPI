<!DOCTYPE html>
<html>
<head>
<title>FaceCheck</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script type="text/javascript">
    //You can authenticate face recognition with the value "Unlock". The default value of the "Unlock" value is 0, but the value obtained by combining the "FaceCheckModel" value and the face matching rate is encrypted. Face matching rates are authenticated when 99% or 100%.
    //Therefore, the Unlock value can be extracted using MD5 encryption as a value of FaceCheckModelName+": "+99 or 100.

    //Use Teachablemachine URL and FaceCheckModelName(MD5) and AfterUnlcok Javascript hear
    FaceCheckModel='ef7c3bd416123b3089ca625cc19f7806';
    const URL = "https://teachablemachine.withgoogle.com/models/mmiBTB3hj/";
    var AfterUnlock='window.location.href="https://naoul.com";'

    let model, webcam, labelContainer, maxPredictions;
    var Unlock=0;
    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
        const flip = true;
        webcam = new tmImage.Webcam(200, 200, flip);
        await webcam.setup();
        await webcam.play();
        window.requestAnimationFrame(loop);
        document.getElementById("webcam-container").appendChild(webcam.canvas);
        labelContainer = document.getElementById("label-container");
        document.getElementById("WebcamLoadText").innerHTML=null;
        setTimeout("FaceCheck();",1000)
        for (let i = 0; i < maxPredictions; i++) {
            labelContainer.appendChild(document.createElement("div"));
        }
    }
    function GetCookie (name) {
	      var pairs = document.cookie.split(";");
	      for(var i=0; i<pairs.length; i++) {
		    var pair = pairs[i].trim();
		    var unit = pair.split("=");
		    if(unit[0] == name)
			    return unescape(unit[1]);
	      }
	      return null;
    }
    function SetCookie (name, value, expireDate) {
    	var cookieStr = name + "=" + escape(value) +
            ((expireDate == null)?"":("; expires=" + expireDate.toGMTString()));
            document.cookie = cookieStr;
    }
    if(GetCookie("Reload")==null){
        var expire = new Date ();
        expire.setTime(expire.getTime() + (2000000000));
      	SetCookie("Reload",1,expire);
        window.location.href=window.location.href;
    }else if(GetCookie("Reload")==0){
        var expire = new Date ();
        expire.setTime(expire.getTime() + (2000000000));
      	SetCookie("Reload",1,expire);
        window.location.href=window.location.href;
    }else if(GetCookie("Reload")==1){
        var expire = new Date ();
        expire.setTime(expire.getTime() + (2000000000));
      	SetCookie("Reload",0,expire);
    }
    async function loop() {
        webcam.update();
        await predict();
        window.requestAnimationFrame(loop);
    }
    async function predict() {
        const prediction = await model.predict(webcam.canvas);
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            labelContainer.childNodes[i].innerHTML = classPrediction;
        }
    }
    function MD5(sMessage) {
    function RotateLeft(lValue, iShiftBits) {
     return (lValue<<iShiftBits) | (lValue>>>(32-iShiftBits));
    }
    function AddUnsigned(lX,lY) {
     var lX4,lY4,lX8,lY8,lResult;
     lX8 = (lX & 0x80000000);
     lY8 = (lY & 0x80000000);
     lX4 = (lX & 0x40000000);
     lY4 = (lY & 0x40000000);
     lResult = (lX & 0x3FFFFFFF)+(lY & 0x3FFFFFFF);
     if(lX4 & lY4)
      return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
     if (lX4 | lY4) {
      if (lResult & 0x40000000)
       return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
      else
       return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
     }
     else
      return (lResult ^ lX8 ^ lY8);
     }
     
    function F(x,y,z) {
     return (x & y) | ((~x) & z);
    }
    function G(x,y,z) {
     return (x & z) | (y & (~z));
    }
    function H(x,y,z) {
     return (x ^ y ^ z);
    }
    function I(x,y,z) {
     return (y ^ (x | (~z)));
    }
    function FF(a,b,c,d,x,s,ac) {
     a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
     return AddUnsigned(RotateLeft(a, s), b);
    }
    function GG(a,b,c,d,x,s,ac) {
     a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
     return AddUnsigned(RotateLeft(a, s), b);
    }
    function HH(a,b,c,d,x,s,ac) {
     a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
     return AddUnsigned(RotateLeft(a, s), b);
    }
    function II(a,b,c,d,x,s,ac) {
     a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
     return AddUnsigned(RotateLeft(a, s), b);
    }
    function ConvertToWordArray(sMessage) {
     var lWordCount;
     var lMessageLength = sMessage.length;
     var lNumberOfWords_temp1=lMessageLength + 8;
     var lNumberOfWords_temp2=(lNumberOfWords_temp1-(lNumberOfWords_temp1 % 64))/64;
     var lNumberOfWords = (lNumberOfWords_temp2+1)*16;
     var lWordArray = Array(lNumberOfWords-1);
     var lBytePosition = 0;
     var lByteCount = 0;
     while ( lByteCount < lMessageLength ) {
      lWordCount = (lByteCount-(lByteCount % 4))/4;
      lBytePosition = (lByteCount % 4)*8;
      lWordArray[lWordCount] = (lWordArray[lWordCount] | (sMessage.charCodeAt(lByteCount)<<lBytePosition));
      lByteCount++;
     }
     lWordCount = (lByteCount-(lByteCount % 4))/4;
     lBytePosition = (lByteCount % 4)*8;
     lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80<<lBytePosition);
     lWordArray[lNumberOfWords-2] = lMessageLength<<3;
     lWordArray[lNumberOfWords-1] = lMessageLength>>>29;
     return lWordArray;
    }
    function WordToHex(lValue) {
     var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;
     for (lCount=0; lCount<=3; lCount++) {
      lByte = (lValue>>>(lCount*8)) & 255;
      WordToHexValue_temp = "0" + lByte.toString(16);
      WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);
     }
     return WordToHexValue;
    }
    var x = Array();
    var k,AA,BB,CC,DD,a,b,c,d;
    var S11=7, S12=12, S13=17, S14=22;
    var S21=5, S22=9 , S23=14, S24=20;
    var S31=4, S32=11, S33=16, S34=23;
    var S41=6, S42=10, S43=15, S44=21;
    x = ConvertToWordArray(sMessage);
    a = 0x67452301; b = 0xEFCDAB89; c = 0x98BADCFE; d = 0x10325476;
    for (k=0;k<x.length;k+=16) {
     AA=a; BB=b; CC=c; DD=d;
     a = FF(a,b,c,d,x[k+0], S11,0xD76AA478);
     d = FF(d,a,b,c,x[k+1], S12,0xE8C7B756);
     c = FF(c,d,a,b,x[k+2], S13,0x242070DB);
     b = FF(b,c,d,a,x[k+3], S14,0xC1BDCEEE);
     a = FF(a,b,c,d,x[k+4], S11,0xF57C0FAF);
     d = FF(d,a,b,c,x[k+5], S12,0x4787C62A);
     c = FF(c,d,a,b,x[k+6], S13,0xA8304613);
     b = FF(b,c,d,a,x[k+7], S14,0xFD469501);
     a = FF(a,b,c,d,x[k+8], S11,0x698098D8);
     d = FF(d,a,b,c,x[k+9], S12,0x8B44F7AF);
     c = FF(c,d,a,b,x[k+10],S13,0xFFFF5BB1);
     b = FF(b,c,d,a,x[k+11],S14,0x895CD7BE);
     a = FF(a,b,c,d,x[k+12],S11,0x6B901122);
     d = FF(d,a,b,c,x[k+13],S12,0xFD987193);
     c = FF(c,d,a,b,x[k+14],S13,0xA679438E);
     b = FF(b,c,d,a,x[k+15],S14,0x49B40821);
     a = GG(a,b,c,d,x[k+1], S21,0xF61E2562);
     d = GG(d,a,b,c,x[k+6], S22,0xC040B340);
     c = GG(c,d,a,b,x[k+11],S23,0x265E5A51);
     b = GG(b,c,d,a,x[k+0], S24,0xE9B6C7AA);
     a = GG(a,b,c,d,x[k+5], S21,0xD62F105D);
     d = GG(d,a,b,c,x[k+10],S22,0x2441453);
     c = GG(c,d,a,b,x[k+15],S23,0xD8A1E681);
     b = GG(b,c,d,a,x[k+4], S24,0xE7D3FBC8);
     a = GG(a,b,c,d,x[k+9], S21,0x21E1CDE6);
     d = GG(d,a,b,c,x[k+14],S22,0xC33707D6);
     c = GG(c,d,a,b,x[k+3], S23,0xF4D50D87);
     b = GG(b,c,d,a,x[k+8], S24,0x455A14ED);
     a = GG(a,b,c,d,x[k+13],S21,0xA9E3E905);
     d = GG(d,a,b,c,x[k+2], S22,0xFCEFA3F8);
     c = GG(c,d,a,b,x[k+7], S23,0x676F02D9);
     b = GG(b,c,d,a,x[k+12],S24,0x8D2A4C8A);
     a = HH(a,b,c,d,x[k+5], S31,0xFFFA3942);
     d = HH(d,a,b,c,x[k+8], S32,0x8771F681);
     c = HH(c,d,a,b,x[k+11],S33,0x6D9D6122);
     b = HH(b,c,d,a,x[k+14],S34,0xFDE5380C);
     a = HH(a,b,c,d,x[k+1], S31,0xA4BEEA44);
     d = HH(d,a,b,c,x[k+4], S32,0x4BDECFA9);
     c = HH(c,d,a,b,x[k+7], S33,0xF6BB4B60);
     b = HH(b,c,d,a,x[k+10],S34,0xBEBFBC70);
     a = HH(a,b,c,d,x[k+13],S31,0x289B7EC6);
     d = HH(d,a,b,c,x[k+0], S32,0xEAA127FA);
     c = HH(c,d,a,b,x[k+3], S33,0xD4EF3085);
     b = HH(b,c,d,a,x[k+6], S34,0x4881D05);
     a = HH(a,b,c,d,x[k+9], S31,0xD9D4D039);
     d = HH(d,a,b,c,x[k+12],S32,0xE6DB99E5);
     c = HH(c,d,a,b,x[k+15],S33,0x1FA27CF8);
     b = HH(b,c,d,a,x[k+2], S34,0xC4AC5665);
     a = II(a,b,c,d,x[k+0], S41,0xF4292244);
     d = II(d,a,b,c,x[k+7], S42,0x432AFF97);
     c = II(c,d,a,b,x[k+14],S43,0xAB9423A7);
     b = II(b,c,d,a,x[k+5], S44,0xFC93A039);
     a = II(a,b,c,d,x[k+12],S41,0x655B59C3);
     d = II(d,a,b,c,x[k+3], S42,0x8F0CCC92);
     c = II(c,d,a,b,x[k+10],S43,0xFFEFF47D);
     b = II(b,c,d,a,x[k+1], S44,0x85845DD1);
     a = II(a,b,c,d,x[k+8], S41,0x6FA87E4F);
     d = II(d,a,b,c,x[k+15],S42,0xFE2CE6E0);
     c = II(c,d,a,b,x[k+6], S43,0xA3014314);
     b = II(b,c,d,a,x[k+13],S44,0x4E0811A1);
     a = II(a,b,c,d,x[k+4], S41,0xF7537E82);
     d = II(d,a,b,c,x[k+11],S42,0xBD3AF235);
     c = II(c,d,a,b,x[k+2], S43,0x2AD7D2BB);
     b = II(b,c,d,a,x[k+9], S44,0xEB86D391);
     a = AddUnsigned(a,AA); b=AddUnsigned(b,BB); c=AddUnsigned(c,CC); d=AddUnsigned(d,DD);
    }
    var temp = WordToHex(a) + WordToHex(b) + WordToHex(c) + WordToHex(d);
    return temp.toLowerCase();
   }
</script>
<style>
canvas{
    border-radius : 1.5rem;
}
#label-container{
    display:none;
}
#webcam-container{
    text-align:center;
}
#CheckImage{
    text-align:center;
}
#WebcamLoadText{
    text-align:center;
}
#button{ 
    border-top-left-radius: 5px; border-bottom-left-radius: 5px; margin-right:-4px; 
    text-align:center; 
}
#btn_group button{ 
    border: 1px solid #B19CD9; background-color: rgba(0,0,0,0); color: #B19CD9; 
    padding: 5px; 
} 
#btn_group button:hover{
    color:white; background-color: #B19CD9; 
}
.loader{
  margin: 0 0 2em;
  height: 0;
  width: 30px;
  text-align: center;
  padding: 0;
  margin: 0 auto 1em;
  display: inline-block;
  vertical-align: top;
}
svg path,
svg rect{
  fill: black;
}
</style>
</head>
<body oncontextmenu="return false">
<div class="FaceCheckElements">
<div id="CheckImage"><img src="/Files/Lock.png" width="20rem"></img></div>
<div id="WebcamLoadText"><div class="loader loader--style3" title="2">
  <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="23px" height="23px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">
  <path fill="#000" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z">
    <animateTransform attributeType="xml"
      attributeName="transform"
      type="rotate"
      from="0 25 25"
      to="360 25 25"
      dur="0.6s"
      repeatCount="indefinite"/>
    </path>
  </svg>
</div>Loading Camera...</div>
<div id="webcam-container"></div>
<div id="label-container"></div>
<div id="Retry" style="display:none;"><a href="javascript:window.location.href=window.location.href;" style="text-align:center"><div id="btn_group" style="text-align:center"> <button id="button" style="text-align:center">The face doesn't match. Click here to try again.</button></div></a></div>
</div>
<script>
init();
i=0;
function FindModel(){
  CheckModel=MD5(document.getElementById("label-container").getElementsByTagName("div")[i].innerText.replace(/[0-9]/g,"").replace(/ /g,"").replace(":","").replace(".",""))
  if(CheckModel!=FaceCheckModel){
    i++;
    FindModel();
  }
}
function FaceCheck(){
  FindModel();
  Model=document.getElementById("label-container").getElementsByTagName("div")[i].innerText;
  FaceMatchingRate=Model.replace(/[^0-9]/gi, "");
  if(FaceMatchingRate>=99){
    Unlock=MD5(Model);
    document.getElementById("label-container").innerHTML=null;
    UnlockMotion();
  }else{
    Unlock=0;
    document.getElementById("label-container").innerHTML=null;
    RetryMotion();
  }
}
function RetryMotion(){
  Model=null;
  FaceMatchingRate=null;
  i=0;
  document.getElementById("Retry").style="";
}
function UnlockMotion(){
  if(Unlock==MD5(Model)){
    document.getElementById("CheckImage").getElementsByTagName("img")[0].src="/Files/Unlock.png";
    Model=null;
    Unlock=null;
    i=0;
    //THIS IS ONLY EXAMPLE, DONT USE THIS CODE.
    //IT HAVE SECURITY PROBLEM.
    setTimeout("eval(AfterUnlock)",200);
  }else{
    setTimeout("UnlockMotion()",200)
  }
}
</script>
</body>
</html>
